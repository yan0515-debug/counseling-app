import streamlit as st
import pandas as pd
import altair as alt

# --- ç³»çµ±è¨­å®š ---
st.set_page_config(page_title="è«®å•†å°ˆæ¥­å–å‘æ·±åº¦æ¢ç´¢ç³»çµ± (CTPS-Based)", page_icon="ğŸ§­", layout="wide")

# --- Session State åˆå§‹åŒ– ---
if 'axis_obj_sub' not in st.session_state:
    st.session_state.axis_obj_sub = 0.0 
if 'axis_ana_exp' not in st.session_state:
    st.session_state.axis_ana_exp = 0.0
if 'history' not in st.session_state:
    st.session_state.history = []

# --- è¼”åŠ©å‡½æ•¸ ---
def update_axes(x_delta, y_delta, reasoning):
    st.session_state.axis_obj_sub += x_delta
    st.session_state.axis_ana_exp += y_delta
    st.session_state.history.append(reasoning)

# --- CSS æ¨£å¼å„ªåŒ– (è®“å­—é«”æ›´å¥½çœ‹) ---
st.markdown("""
<style>
    .big-font {
        font-size:24px !important;
        font-weight: bold;
        color: #2c3e50;
    }
    .scenario-box {
        background-color: #f0f2f6;
        padding: 20px;
        border-radius: 10px;
        border-left: 5px solid #4a90e2;
    }
</style>
""", unsafe_allow_html=True)

# --- å´é‚Šæ¬„ ---
st.sidebar.title("ğŸ§­ å°ˆæ¥­å°èˆª")
step = st.sidebar.radio(
    "éšæ®µé¸æ“‡ï¼š",
    ["å‰è¨€ï¼šç†è«–æ¶æ§‹", "1. éš±å–»æŠ•å°„ (è§’è‰²è§€)", "2. è‡¨åºŠæ±ºç­– (æ”¹è®Šè§€)", "3. é™°å½±æ¢ç´¢ (åƒ¹å€¼è§€)", "4. ç©ºé–“é…ç½® (æ¡†æ¶è§€)", "5. ç¶œåˆåˆ†æå ±å‘Š"]
)

# ==========================================
# å‰è¨€
# ==========================================
if step == "å‰è¨€ï¼šç†è«–æ¶æ§‹":
    st.title("è«®å•†å°ˆæ¥­å–å‘æ·±åº¦æ¢ç´¢ç³»çµ± v2.0")
    st.markdown("### æ­¡è¿ä¾†åˆ°æ‚¨çš„å°ˆæ¥­æ¢ç´¢æ—…ç¨‹")
    st.info("æœ¬ç³»çµ±ç¶“éå„ªåŒ–ï¼ŒåŠ å…¥åœ–åƒå¼•å°èˆ‡æƒ…å¢ƒæ¨¡æ“¬ï¼Œä¾æ“š CTPS é›™è»¸å‘ç†è«–å”åŠ©æ‚¨å®šä½è‡ªå·±çš„æ²»ç™‚é¢¨æ ¼ã€‚")

# ==========================================
# éšæ®µ 1: éš±å–»æŠ•å°„
# ==========================================
elif step == "1. éš±å–»æŠ•å°„ (è§’è‰²è§€)":
    st.header("Phase 1: æ²»ç™‚é—œä¿‚ä¸­çš„è§’è‰²")
    
    st.markdown("#### Q1. å¦‚æœè«®å•†æ˜¯ä¸€æ¬¡ç™»å±±ï¼Œçœ‹è‘—ä¸‹æ–¹çš„ç¤ºæ„åœ–ï¼Œæ‚¨è¦ºå¾—è‡ªå·±æœ€åƒå“ªä¸€ç¨®è§’è‰²ï¼Ÿ")
    
    # ä½¿ç”¨ Columns æ’ç‰ˆåœ–ç‰‡ (é€™è£¡ä½¿ç”¨ç¶²è·¯åœ–åº«çš„ç¤ºæ„é€£çµï¼Œæ‚¨ä¹‹å¾Œå¯ä»¥æ›æˆè‡ªå·±çš„)
    c1, c2, c3, c4 = st.columns(4)
    with c1:
        st.image("https://images.unsplash.com/photo-1501555088652-021faa106b9b?w=300", caption="A. åš®å°")
    with c2:
        st.image("https://images.unsplash.com/photo-1478131143081-80f7f84ca84d?w=300", caption="B. ä¼´ä¾¶")
    with c3:
        st.image("https://images.unsplash.com/photo-1533227297464-94291e6e9c43?w=300", caption="C. è§€å¯Ÿè€…")
    with c4:
        st.image("https://images.unsplash.com/photo-1526628953301-3e589a6a8b74?w=300", caption="D. æ•™ç·´")

    choice1 = st.radio("è«‹é¸æ“‡æ‚¨çš„è§’è‰²ï¼š", [
        "A. åš®å°ï¼šæˆ‘èµ°åœ¨å‰é¢ï¼Œç†Ÿæ‚‰è·¯å¾‘ï¼Œèƒ½å‘Šè¨´å€‹æ¡ˆå“ªè£¡å®‰å…¨ã€å“ªè£¡å±éšªã€‚",
        "B. ä¼´ä¾¶ï¼šæˆ‘èµ°åœ¨æ—é‚Šï¼Œé…åˆä»–çš„é€Ÿåº¦ï¼Œæˆ‘å€‘ä¸€èµ·ç¶“æ­·é¢¨é›¨ã€‚",
        "C. è§€å¯Ÿè€…ï¼šæˆ‘ç¨ç¨èµ°åœ¨å¾Œæ–¹ï¼Œä¿æŒå…¨è§€çš„è¦–é‡ï¼Œçœ‹æ¸…ä»–èµ°è·¯çš„å§¿å‹¢èˆ‡æ…£æ€§ã€‚",
        "D. æ•™ç·´ï¼šæˆ‘åœ¨æ—è§€å¯Ÿèˆ‡æ¿€å‹µï¼ŒæŒ‡å°ä»–èª¿æ•´å‘¼å¸èˆ‡æ­¥ä¼ï¼Œç™¼æ®æ½›èƒ½ã€‚"
    ])
    
    if st.button("ç¢ºèª Q1"):
        if "A" in choice1: update_axes(2.0, 1.0, "è§’è‰²-åš®å°: å‚¾å‘å®¢è§€æŒ‡å°")
        if "B" in choice1: update_axes(-2.0, -2.0, "è§’è‰²-ä¼´ä¾¶: å‚¾å‘ä¸»è§€é«”é©—")
        if "C" in choice1: update_axes(-1.0, 3.0, "è§’è‰²-è§€å¯Ÿè€…: å‚¾å‘å‹•åŠ›åˆ†æ")
        if "D" in choice1: update_axes(2.0, 2.0, "è§’è‰²-æ•™ç·´: å‚¾å‘ç†æ€§èª¿æ•´")
        st.success("è§’è‰²å‚¾å‘å·²è¨˜éŒ„ã€‚")

    st.markdown("---")
    
    # æ”¾å¤§åŠ ç²—çš„é¡Œç›®
    st.markdown('<p class="big-font">Q2. è«‹èª å¯¦è©•ä¼°ä»¥ä¸‹æ•˜è¿°ï¼š</p>', unsafe_allow_html=True)
    st.markdown('### ã€Œæˆ‘èªç‚ºæ²»ç™‚å¸«ä¿æŒå®¢è§€ä¸­ç«‹çš„ã€æŠ€è¡“å°ˆå®¶ã€å½¢è±¡ï¼Œæ¯”å±•ç¾å€‹äººç‰¹è³ªæ›´é‡è¦ã€‚ã€')
    
    q2_score = st.slider("æ»‘å‹•ä»¥è©•åˆ† (1=å®Œå…¨ä¸èªåŒ, 5=å®Œå…¨èªåŒ)", 1, 5, 3)
    
    if st.button("ç¢ºèª Q2"):
        val = q2_score - 3
        update_axes(val * 1.5, 0, f"æ ¡æº–é¡Œ-å°ˆå®¶å½¢è±¡: {q2_score}åˆ†")
        st.success("æ ¡æº–å®Œæˆã€‚")

# ==========================================
# éšæ®µ 2: è‡¨åºŠæ±ºç­– (æ¨¡ç³ŠåŒ–èˆ‡ç´°ç·»åŒ–)
# ==========================================
elif step == "2. è‡¨åºŠæ±ºç­– (æ”¹è®Šè§€)":
    st.header("Phase 2: æ”¹è®Šæ˜¯å¦‚ä½•ç™¼ç”Ÿçš„ï¼Ÿ")
    
    st.markdown("è«‹é–±è®€ä»¥ä¸‹æƒ…å¢ƒï¼Œä¸¦æ„Ÿå—ç¾å ´çš„æ°£æ°›ã€‚")
    
    # æ›´ç´°ç·»çš„æƒ…å¢ƒæè¿°
    st.markdown("""
    <div class="scenario-box">
    <b>æƒ…å¢ƒï¼š</b><br>
    å€‹æ¡ˆå°æ˜ï¼ˆ30æ­²ï¼Œå·¥ç¨‹å¸«ï¼‰ååœ¨ä½ å°é¢çš„æ²™ç™¼ä¸Šã€‚ä»–æ•´å€‹äººç¸®æˆä¸€åœ˜ï¼Œé›™æ‰‹ç·Šç·ŠæŠ“è‘—è†è“‹ï¼Œçœ¼ç¥ç›¯è‘—åœ°æ¿ï¼Œå·²ç¶“æ²ˆé»˜äº†äº”åˆ†é˜ã€‚<br><br>
    ç©ºæ°£æœ‰äº›å‡é‡ï¼Œä½ æ„Ÿè¦ºåˆ°ä»–ä¼¼ä¹æƒ³èªªè©±ï¼Œä½†åˆåƒæ˜¯å¡ä½äº†ã€‚çªç„¶ï¼Œä»–æŠ¬èµ·é ­ï¼Œçœ¼çœ¶æ³›ç´…ï¼Œç”¨å¾®å¼±é¡«æŠ–çš„è²éŸ³åå‡ºä¸€å¥ï¼š<br>
    <b>ã€Œæˆ‘è¦ºå¾—â€¦â€¦æˆ‘é€™è¼©å­å¥½åƒè¨»å®šå°±æ˜¯å€‹å¤±æ•—å“ï¼Œä¸ç®¡æ€éº¼åŠªåŠ›ï¼Œæœ€å¾Œéƒ½æœƒæç ¸â€¦â€¦ã€</b>
    </div>
    """, unsafe_allow_html=True)
    
    st.write("")
    st.subheader("Q: åœ¨é‚£ä¸€ç¬é–“ï¼Œä½ ç›´è¦ºæœ€æƒ³å°ä»–èªªçš„ä¸€å¥è©±æ˜¯ï¼Ÿ")
    
    # æ¨¡ç³ŠåŒ–é¸é …ï¼šå»é™¤å­¸æ´¾åè©ï¼Œæ”¹ç‚ºå…·é«”å›æ‡‰
    choice_scene = st.radio("è«‹ä¾ç›´è¦ºé¸æ“‡ï¼š", [
        "1. ã€Œä½ èªªä½ æ˜¯ã€å¤±æ•—å“ã€ï¼Œèƒ½ä¸èƒ½å¤šèªªä¸€é»ï¼Œä½ æ˜¯ä¾æ“šä»€éº¼è­‰æ“šä¾†é€™æ¨£å®šç¾©è‡ªå·±çš„ï¼Ÿã€",
        "2. ï¼ˆèº«é«”å¾®å¾®å‰å‚¾ï¼Œæ”¾æ…¢èªé€Ÿï¼‰ã€Œè½èµ·ä¾†ä½ ç¾åœ¨çœŸçš„å¥½æŒ«æŠ˜ã€å¥½ç„¡åŠ›â€¦â€¦é‚£ç¨®æ„Ÿè¦ºåƒæ˜¯è¢«å¾¹åº•æ‰“æ•—äº†ï¼Œæ˜¯å—ï¼Ÿã€",
        "3. ã€Œæˆ‘æ³¨æ„åˆ°ç•¶ä½ èªªé€™å¥è©±æ™‚ï¼Œä½ çš„é›™æ‰‹æŠ“å¾—å¥½ç·Šï¼Œå°±åƒç•¶å¹´é‚£å€‹ç¸½æ˜¯é”ä¸åˆ°çˆ¶è¦ªè¦æ±‚çš„å°ç”·å­©ä¸€æ¨£â€¦â€¦ã€",
        "4. ã€Œé›–ç„¶ä½ ç¾åœ¨è¦ºå¾—å¾ˆç³Ÿï¼Œä½†åœ¨éå»é€™æ®µæ—¥å­è£¡ï¼Œæœ‰æ²’æœ‰å“ªä¸€å€‹æ™‚åˆ»ï¼Œäº‹æƒ…å…¶å¯¦ã€æ²’æœ‰ã€æç ¸å¾—é‚£éº¼åš´é‡ï¼Ÿã€"
    ])
    
    if st.button("ç¢ºèªå›æ‡‰"):
        if "1" in choice_scene: update_axes(2.0, 2.0, "æƒ…å¢ƒ-è­‰æ“šæª¢é©—: å‚¾å‘ç†æ€§é‡æ§‹") # CBT
        if "2" in choice_scene: update_axes(-2.0, -2.0, "æƒ…å¢ƒ-æƒ…æ„Ÿåæ˜ : å‚¾å‘ç•¶ä¸‹é«”é©—") # Humanistic
        if "3" in choice_scene: update_axes(-1.0, 3.0, "æƒ…å¢ƒ-å‹•åŠ›è©®é‡‹: å‚¾å‘é€£çµéå»") # Psychodynamic
        if "4" in choice_scene: update_axes(1.0, 1.0, "æƒ…å¢ƒ-å°‹æ‰¾ä¾‹å¤–: å‚¾å‘è¡Œå‹•å»ºæ§‹") # SFBT/PostModern
        st.success("ä»‹å…¥é¢¨æ ¼å·²åˆ†æã€‚")

# ==========================================
# éšæ®µ 3: é™°å½±æ¢ç´¢ (æ’åºæ³•)
# ==========================================
elif step == "3. é™°å½±æ¢ç´¢ (åƒ¹å€¼è§€)":
    st.header("Phase 3: ææ‡¼èˆ‡é¿å…")
    st.markdown("æ¦®æ ¼å¿ƒç†å­¸èªç‚ºï¼Œæˆ‘å€‘æœ€ç„¡æ³•å¿å—çš„ç‰¹è³ªï¼ˆé™°å½±ï¼‰ï¼Œå¾€å¾€æš—ç¤ºäº†æˆ‘å€‘æ½›æ„è­˜æœ€åœ¨ä¹çš„åƒ¹å€¼ã€‚")
    
    st.subheader("è«‹æƒ³åƒå„ç¨®ã€Œç³Ÿç³•çš„æ²»ç™‚å¸«ã€å½¢è±¡...")
    
    shadow_options = {
        "A": "å¤±æ§çš„æ²»ç™‚å¸«ï¼šç•Œç·šæ¨¡ç³Šï¼Œè¢«å€‹æ¡ˆçš„æƒ…ç·’æ²é€²å»ï¼Œè·Ÿè‘—å€‹æ¡ˆä¸€èµ·å“­ï¼Œä¸çŸ¥æ‰€æªã€‚",
        "B": "å†·è¡€çš„æ²»ç™‚å¸«ï¼šåƒå€‹å†°å†·çš„åˆ†ææ©Ÿå™¨ï¼Œåªæœ‰ç†è«–æ²’æœ‰æº«åº¦ï¼Œå®Œå…¨æ„Ÿè¦ºä¸åˆ°äººæ€§ã€‚",
        "C": "é¬¼æ‰“ç‰†çš„æ²»ç™‚å¸«ï¼šè«‡äº†å¾ˆä¹…å»æ¯«ç„¡é€²å±•ï¼Œæ²’æœ‰ç›®æ¨™ï¼Œæ¯é€±åªæ˜¯ä¾†èŠèŠå¤©ï¼Œæµªè²»æ™‚é–“ã€‚",
        "D. éœ¸é“çš„æ²»ç™‚å¸«ï¼šè‡ªä»¥ç‚ºæ˜¯å°ˆå®¶ï¼ŒæŠŠè‡ªå·±çš„åƒ¹å€¼è§€å¼·åŠ åœ¨å€‹æ¡ˆèº«ä¸Šï¼Œä¸è½å€‹æ¡ˆè§£é‡‹ã€‚"
    }

    st.write("è«‹é¸å‡ºæ‚¨å¿ƒä¸­çš„ã€Œç¬¬ä¸€åã€èˆ‡ã€Œç¬¬äºŒåã€ç„¡æ³•å¿å—çš„ç‰¹è³ªï¼š")
    
    # é¿å…å…¨é¸ï¼Œæ”¹ç‚ºæ’åºï¼ˆTop 1 & Top 2ï¼‰
    shadow_1 = st.selectbox("ğŸ’€ ç¬¬ä¸€åæœ€ç„¡æ³•å¿å—ï¼ˆæœ€åƒå™©å¤¢ï¼‰çš„æ˜¯ï¼š", ["è«‹é¸æ“‡..."] + list(shadow_options.values()))
    shadow_2 = st.selectbox("ğŸ’€ ç¬¬äºŒåç„¡æ³•å¿å—çš„æ˜¯ï¼š", ["è«‹é¸æ“‡..."] + list(shadow_options.values()))
    
    if st.button("åˆ†æé™°å½±"):
        if shadow_1 == "è«‹é¸æ“‡..." or shadow_2 == "è«‹é¸æ“‡...":
            st.error("è«‹å®Œæˆå…©é …é¸æ“‡ã€‚")
        elif shadow_1 == shadow_2:
            st.error("ç¬¬ä¸€åèˆ‡ç¬¬äºŒåä¸èƒ½ç›¸åŒï¼Œè«‹é‡æ–°é¸æ“‡ã€‚")
        else:
            # åŠ æ¬Šé‚è¼¯ï¼šç¬¬ä¸€åæ¬Šé‡ 1.5ï¼Œç¬¬äºŒåæ¬Šé‡ 1.0
            def analyze_shadow(text, weight):
                if "å¤±æ§" in text: update_axes(1.5 * weight, 0, f"é™°å½±-æ€•å¤±æ§(w={weight}): éœ€æ±‚çµæ§‹")
                if "å†·è¡€" in text: update_axes(-1.5 * weight, -1.0 * weight, f"é™°å½±-æ€•å†·è¡€(w={weight}): éœ€æ±‚æƒ…æ„Ÿ")
                if "é¬¼æ‰“ç‰†" in text: update_axes(1.0 * weight, 1.5 * weight, f"é™°å½±-æ€•æ²’æ•ˆ(w={weight}): éœ€æ±‚æ”¹è®Š")
                if "éœ¸é“" in text: update_axes(-1.5 * weight, 0, f"é™°å½±-æ€•éœ¸é“(w={weight}): éœ€æ±‚å°Šé‡")

            analyze_shadow(shadow_1, 1.5)
            analyze_shadow(shadow_2, 1.0)
            st.success("é™°å½±åƒ¹å€¼è§€åˆ†æå®Œæˆã€‚")

# ==========================================
# éšæ®µ 4: ç©ºé–“é…ç½® (åœ–ç¤ºåŒ–)
# ==========================================
elif step == "4. ç©ºé–“é…ç½® (æ¡†æ¶è§€)":
    st.header("Phase 4: ç‰©ç†ç’°å¢ƒèˆ‡æ²»ç™‚æ¡†æ¶")
    st.write("é–‰ä¸Šçœ¼ç›ï¼Œæƒ³åƒæ‚¨æ“æœ‰ä¸€é–“å®Œå…¨å±¬æ–¼è‡ªå·±çš„è«®å•†å®¤ã€‚")
    
    st.subheader("Q1. æ‚¨è¦ºå¾—æœ€èˆ’æœçš„ã€Œåº§ä½è·é›¢ã€æ˜¯ï¼Ÿ")
    st.caption("è«‹æ‹–å‹•æ»‘æ¡¿ï¼Œé¸æ“‡æœ€ç¬¦åˆç›´è¦ºçš„ç•«é¢")
    
    # ä½¿ç”¨ select_slider æ­é… Emoji è®“è·é›¢æ„Ÿå…·è±¡åŒ–
    dist_choice = st.select_slider(
        "è·é›¢é¸æ“‡",
        options=["ğŸ«‚ è¦ªå¯†æ¥è§¸", "ğŸ¤ ä¼¸æ‰‹å¯åŠ", "ğŸ›‹ï¸ ä¸€èˆ¬ç¤¾äº¤ (ç´„150cm)", "ğŸ”­ é™é™ç›¸æœ›", "ğŸ›¡ï¸ æ¥µåº¦å®‰å…¨ (èƒŒå°æˆ–æ¥µé )"],
        value="ğŸ›‹ï¸ ä¸€èˆ¬ç¤¾äº¤ (ç´„150cm)"
    )
    
    st.write(f"æ‚¨é¸æ“‡äº†ï¼š**{dist_choice}**")

    st.markdown("---")
    st.subheader("Q2. é—œæ–¼è¨­å‚™")
    # æ˜ç¢ºå®šç¾©ç™½æ¿çš„åŠŸèƒ½ï¼Œé¿å…æ··æ·†
    whiteboard = st.checkbox("æˆ‘å¸Œæœ›ç‰†ä¸Šæœ‰ä¸€å¡Šå¤§ç™½æ¿æˆ–æ›åœ–æ¶ï¼ˆç”¨é€”ï¼šæ–¹ä¾¿æ•™å­¸ã€åˆ—é»ã€åˆ†æçµæ§‹æˆ–ç•«å‡ºå¾ªç’°åœ–ï¼‰")
    
    if st.button("ç¢ºèªé…ç½®"):
        # è·é›¢è¨ˆåˆ†é‚è¼¯
        # è¦ªå¯†/é è¿‘ -> é«”é©—/ä¸»è§€ (è² åˆ†)
        # é™é /å®‰å…¨ -> åˆ†æ/å®¢è§€ (æ­£åˆ†)
        score_map = {
            "ğŸ«‚ è¦ªå¯†æ¥è§¸": -2.0,
            "ğŸ¤ ä¼¸æ‰‹å¯åŠ": -1.0,
            "ğŸ›‹ï¸ ä¸€èˆ¬ç¤¾äº¤ (ç´„150cm)": 0.0,
            "ğŸ”­ é™é™ç›¸æœ›": 1.0,
            "ğŸ›¡ï¸ æ¥µåº¦å®‰å…¨ (èƒŒå°æˆ–æ¥µé )": 2.0
        }
        d_score = score_map[dist_choice]
        # Xè»¸ç¨å¾®å½±éŸ¿ï¼Œä¸»è¦å½±éŸ¿ Yè»¸ (é«”é©— vs åˆ†æ)
        update_axes(d_score * 0.5, d_score, f"ç©ºé–“-è·é›¢: {dist_choice}")
        
        if whiteboard:
            # ç™½æ¿é€šå¸¸èˆ‡ CBT/æ•™å­¸/çµæ§‹æœ‰é—œ
            update_axes(1.5, 1.5, "ç©ºé–“-æœ‰ç™½æ¿: é‡è¦–çµæ§‹åŒ–èˆ‡è¦–è¦ºæ•™å­¸")
        else:
            update_axes(-0.5, -0.5, "ç©ºé–“-ç„¡ç™½æ¿: é‡è¦–è‡ªç„¶å°è©±")
            
        st.success("ç©ºé–“å¿ƒç†åˆ†æå®Œæˆã€‚")

# ==========================================
# éšæ®µ 5: ç¶œåˆåˆ†æå ±å‘Š (ä¸è®Š)
# ==========================================
elif step == "5. ç¶œåˆåˆ†æå ±å‘Š":
    st.title("ğŸ“Š è«®å•†å°ˆæ¥­å–å‘åˆ†æå ±å‘Š")
    
    x = st.session_state.axis_obj_sub
    y = st.session_state.axis_ana_exp
    
    st.subheader("1. ç†è«–åœ°åœ–å®šä½")
    st.write(f"åº§æ¨™è½é»ï¼šX (å®¢è§€æ€§) = {x:.1f}, Y (ç†æ€§åˆ†æ) = {y:.1f}")
    
    # ç¹ªåœ–æ•¸æ“š
    source = pd.DataFrame({'X': [x], 'Y': [y], 'Label': ['æ‚¨çš„ä½ç½®']})
    
    # ç°¡å–®ç¹ªåœ–
    chart = alt.Chart(source).mark_circle(size=300, color='#e74c3c').encode(
        x=alt.X('X', scale=alt.Scale(domain=[-10, 10]), title='ä¸»è§€/å»ºæ§‹ <-----> å®¢è§€/å¯¦è­‰'),
        y=alt.Y('Y', scale=alt.Scale(domain=[-10, 10]), title='é«”é©—/æƒ…æ„Ÿ <-----> ç†æ€§/æ€è€ƒ'),
        tooltip=['Label', 'X', 'Y']
    ).interactive().properties(width=600, height=500)
    
    st.altair_chart(chart, use_container_width=True)
    
    # è±¡é™è§£é‡‹
    st.subheader("2. é¢¨æ ¼è§£æ")
    if x >= 0 and y >= 0:
        st.success("ã€ç¬¬ä¸€è±¡é™ï¼šèªçŸ¥èˆ‡è¡Œç‚ºå–å‘ã€‘\næ‚¨å‚¾å‘ç›¸ä¿¡å•é¡Œæœ‰å…¶å®¢è§€æˆå› ï¼Œä¸”èƒ½é€éå­¸ç¿’èˆ‡ç·´ç¿’ä¾†ä¿®æ­£ã€‚é©åˆ CBT, REBT, SFBTã€‚")
    elif x < 0 and y >= 0:
        st.info("ã€ç¬¬äºŒè±¡é™ï¼šå¿ƒç†å‹•åŠ›å–å‘ã€‘\næ‚¨å‚¾å‘æ¢ç´¢å€‹æ¡ˆçš„å…§åœ¨ä¸–ç•Œã€‚ç›¸ä¿¡é€éç†æ€§çš„æ´å¯Ÿ (Insight) èƒ½å¸¶ä¾†æ·±å±¤æ”¹è®Šã€‚é©åˆç²¾ç¥åˆ†æã€å®¢é«”é—œä¿‚ã€‚")
    elif x < 0 and y < 0:
        st.warning("ã€ç¬¬ä¸‰è±¡é™ï¼šäººæœ¬èˆ‡é«”é©—å–å‘ã€‘\næ‚¨ç›¸ä¿¡é—œä¿‚æœ¬èº«å°±æ˜¯æ²»ç™‚ã€‚é‡è¦–æ­¤æ™‚æ­¤åˆ»çš„çœŸèª æ¥è§¸èˆ‡æƒ…æ„Ÿæµå‹•ã€‚é©åˆå®Œå½¢ã€äººæœ¬ã€å­˜åœ¨ä¸»ç¾©ã€‚")
    else:
        st.error("ã€ç¬¬å››è±¡é™ï¼šç­–ç•¥èˆ‡è¡Œå‹•å–å‘ã€‘\né‡è¦–å…·é«”çš„è¡Œå‹•æ”¹è®Šï¼Œä½†é—œæ³¨å€‹åˆ¥åŒ–çš„ä¸»è§€æ„ç¾©ã€‚å¯èƒ½å‚¾å‘æ–¼ç¾å¯¦æ²»ç™‚æˆ–ç­–ç•¥å­¸æ´¾ã€‚")

    with st.expander("æŸ¥çœ‹è©³ç´°åˆ¤æ–·æ­·ç¨‹"):
        for item in st.session_state.history:
            st.write(f"- {item}")
